<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro Masivo de Usuarios</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
      "https://<CursosJasdrol.supabase.co",
      "<https://eevijzdfqmhzuptwbkpw.supabase.co>"
    );

    window.handleFile = async (evt) => {
      const file = evt.target.files[0];
      const data = await file.arrayBuffer();
      const workbook = XLSX.read(data, { type: "array" });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const usuarios = XLSX.utils.sheet_to_json(sheet);

      for (const u of usuarios) {
        const correo = u.correo.trim();
        const password = u.dni.trim();
        const { error } = await supabase.auth.admin.createUser({
          email: correo,
          password: password,
          email_confirm: true
        });

        if (error) {
          console.error(`❌ Error con ${correo}:`, error.message);
        } else {
          console.log(`✅ Usuario creado: ${correo}`);
        }
      }

      alert("✔️ Proceso terminado. Revisa consola (F12) para ver resultados.");
    };
  </script>
</head>
<body>
  <h2>Registro Masivo de Usuarios (DNI como clave)</h2>
  <input type="file" accept=".xlsx" onchange="handleFile(event)" />
</body>
</html>